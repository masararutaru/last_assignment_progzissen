services:
  # Java/Maven環境（既存）
  math:
    build: .
    container_name: handwritten-math
    tty: true
    stdin_open: true
    volumes:
      - .:/app
      - m2:/root/.m2
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    environment:
      - DISPLAY=${DISPLAY:-:0}
    command: ["bash", "-lc", "sleep infinity"]

  # Python/PyTorch環境（学習・ONNX変換用）
  python:
    build:
      context: .
      dockerfile: Dockerfile.python
    container_name: handwritten-math-python
    tty: true
    stdin_open: true
    volumes:
      - .:/app
      - pip_cache:/root/.cache/pip
    command: ["bash", "-lc", "sleep infinity"]
    environment:
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_DEFAULT_REGION: ${AWS_DEFAULT_REGION}
    # GPUが必要な場合は以下をコメントアウト
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]

volumes:
  m2:
  pip_cache:
